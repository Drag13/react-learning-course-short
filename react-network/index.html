<!DOCTYPE html><html lang="en"><head><link rel="stylesheet" href="https://drag13.io/react-learning-course-short/about/index.49374549.css"><meta charset="utf-8"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>React For Beginners - React and network</title><meta name="description" content="Free learning course - React: React and network"><meta name="keywords" content="react free learning course beginners"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="React For Beginners - React and network"><meta name="twitter:site" content="https://github.com/Drag13/react-learning-course-short/react-network/index.html"><meta name="twitter:creator" content="@drag137"><meta name="twitter:image" content="https://drag13.io/react-learning-course-short/shared/imgs/title.png"><meta property="og:image" content="https://drag13.io/react-learning-course-short/shared/imgs/title.png"><meta property="og:title" content="React For Beginners - React and network"><meta name="og:site_name" content="React For Beginners - React and network"><meta property="og:url" content="https://drag13.io/react-learning-course-short/react-network/index.htnl"><meta property="og:type" content="website"><meta name="application-name" content="React For Beginners - React and network"><meta name="author" content="drag13"><meta name="robots" content="index follow"><link rel="stylesheet" href="https://drag13.io/react-learning-course-short/about/index.1568b79b.css"><link rel="stylesheet" href="https://drag13.io/react-learning-course-short/about/index.698ea738.css"><link rel="stylesheet" href="https://drag13.io/react-learning-course-short/react-change-detection/index.8e0c3b31.css"></head><body> <div class="reveal"> <div class="slides"> <section> <h1 class="ukraine"> Free React Course <br> For Beginners </h1> </section> <section> <h1>L9 - React and network</h1> <h4> <u> React For Beginners by Itera </u> </h4> </section> <section> <h2>Key Points</h2> <ul> <li class="fade-up fragment">Fetch</li> <li class="fade-up fragment">Axios</li> <li class="fade-up fragment">Network and store</li> <li class="fade-up fragment">Typical mistakes</li> </ul> </section> <section> <section> <h2>Fetch</h2> </section> <section> <h3>In a nutshell working with network is easy</h3> </section> <section> <h3>Schema</h3> <ul> <li> Use <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API"></a> fetch api to issue an network request </li> <li class="fade-up fragment">Update state on success</li> <li class="fade-up fragment">Handle error if any</li> </ul> </section> <section> <h3>Class based component example</h3> </section> <section> <h3>Define a class with an initial state</h3> <pre><code data-line-numbers="" class="language-tsx">class FreeApi extends PureComponent {
    state = { errored: false, apis: [] };
}
            </code></pre> </section> <section> <h3>On ComponentDidMount implement fetching</h3> <pre><code data-line-numbers="1-9|3|4|5|7" class="language-tsx">async componentDidMount() {
    try {
        const rawData = await fetch(FREE_API_URL);
        const { entries } = await rawData.json();
        this.setState({ errored:false, apis: entries });
    } catch (e) {
        this.setState({ errored: true, apis: [] });
    }
}</code></pre> </section> <section> <h3>Render the result</h3> <pre><code data-line-numbers="1-11|2|3|4|5-9" class="language-tsx">render() {
    const { apis, errored } = this.state;
    return errored 
        ? (&lt;div&gt;Something went wrong&lt;/div&gt;) 
        : &lt;ul&gt;{apis.map(({ API, Link }) =&gt; (
                &lt;li key={Link}&gt;
                {API}::{Link}
                &lt;/li&gt;
            ))}
        &lt;/ul&gt;;
}</code></pre> </section> <section> <h3> Full <a href="https://raw.githubusercontent.com/Drag13/react-learning-course-short/master/presentations/react-network/code/fetch-cb.tsx" target="_blank" rel="noopener noreferrer">example</a> </h3> </section> <section> <h3>Functional example</h3> </section> <section> <h3>Create custom hook with default state</h3> <pre><code data-line-numbers="" class="language-tsx">import { PureComponent, useEffect, useState } from "react";

const useFreeApi = () =&gt; {
  const [data, setApi] = useState({ errored: false, apis: [] });
  return data;
};
            </code></pre> </section> <section> <h3>Add useEffect hook with fetch inside</h3> <pre><code class="language-tsx" data-line-numbers="1-12|2|4-6|8">useEffect(() =&gt; {
    async function updateApi() {
        try {
            const rawData = await fetch(FREE_API_URL);
            const { entries } = await rawData.json();
            setApi({ errored: false, apis: entries });
        } catch (error) {
            setApi({ errored: true, apis: [] });
        }
    }
    updateApi();
}, []);</code></pre> </section> <section> <h3>Pay attention to useEffect</h3> <p class="left">If you will call fetch directly - the request will be issued every re-render</p> </section> <section> <h3>Pay attention to useEffect</h3> <p class="left"> Don't forget to set an empty array of dependencies to fire useEffect only once </p> </section> <section> <h3>Use the new hook as usual</h3> <pre><code data-line-numbers="" class="language-tsx">const FreeApi = () =&gt; {
    const { errored, apis } = useFreeApi();
    return errored 
        ? (&lt;div&gt;Something went wrong&lt;/div&gt;) 
        : (&lt;ul&gt;
            {apis.map(({ API, Link }) =&gt; (
                &lt;li key={Link}&gt;
                {API}::{Link}
                &lt;/li&gt;
            ))}
          &lt;/ul&gt;);
};</code></pre> </section> <section> <h3> Full <a href="https://raw.githubusercontent.com/Drag13/react-learning-course-short/master/presentations/react-network/code/fetch-functional.tsx" target="_blank" rel="noopener noreferrer">example</a> </h3> </section> <section> <h3>However, fetch has some pitfalls</h3> </section> <section> <h3>Internet Explorer</h3> <p class="left"> Despite Internet Explorer being deprecated even by the author, it's still popular in a big companies </p> <p class="fade-up fragment left"><strong> Fetch doesn't work in IE </strong></p> </section> <section> <h3>Canceling request</h3> <p class="left">Sometimes you will need to cancel a request</p> <p class="fade-up fragment left"><strong> Fetch doesn't cancel </strong></p> <p class="fade-up fragment left">The work on canceling is ongoing</p> </section> <section> <h3>No progress tracking, no timeout</h3> <p>Fetch is a bit limited</p> </section> </section> <section> <section> <h2>Axios</h2> </section> <section> <h3>Axios@0.26.1</h3> <ul> <li>‚≠ê 92_000</li> <li class="fade-up fragment">Downloads: 28,198,607</li> <li class="fade-up fragment">Size: 16kB</li> </ul> </section> <section> <h3>Benefits</h3> <ul> <li>Works with IE üíî</li> <li class="fade-up fragment">Supports aborting request</li> <li class="fade-up fragment">Support progress</li> <li class="fade-up fragment">Support interceptors</li> </ul> </section> <section> <h3>Example</h3> <pre><code class="language-typescript" data-line-numbers="1-14|1|6|7">const axios = Axios.create();
...
useEffect(() =&gt; {
    async function updateApi() {
        try {
            const { data } = await axios.get(FREE_API_URL);
            const { entries } = data;
            setApi({ errored: false, apis: entries });
        } catch (error) {
            setApi({ errored: true, apis: [] });
        }
    }
    updateApi();
}, []);
            </code></pre> </section> <section> <h3>Differences</h3> <ul> <li>Need to create an instance before using</li> <li class="fragment">Don't need to use <i>.toJson()</i> to get an object</li> </ul> </section> <section> <h3>Why to use - global config</h3> <pre><code data-line-numbers="" class="language-typescript">const axios = Axios.create({
    baseURL: 'https://some-domain.com/api/',
    timeout: 1000,
    headers: {'X-Custom-Header': 'foobar'}
});
        </code></pre> </section> <section> <h3>Why to use - easy to cancel</h3> <pre><code data-line-numbers="1-9|1|4-5|8" class="language-tsx">const abort = new AbortController();
useEffect(()=>{
    try {
      const { data } = await axios.get(FREE_API_URL, 
        { signal: abort.signal });
    }
    ...
    return ()=> abort.abort()
}, [])
</code></pre> <p class="fade-up fragment left">You can use AbortController or legacy CancelToken</p> </section> <section> <h3>Why to use - interceptors</h3> <pre><code data-line-numbers="1-5|2-4|3|4" class="language-typescript">const axios = Axios.create();
axios.interceptors.response.use((response) =&gt; {
    console.log(response.request.responseURL);
    return response;
});</code></pre> </section> <section> <h3> Full <a href="https://raw.githubusercontent.com/Drag13/react-learning-course-short/master/presentations/react-network/code/fetch-axios.tsx" target="_blank" rel="noopener noreferrer">example</a> </h3> </section> </section> <section> <section> <h3>What to use?</h3> <ul> <li> Fetch - for a simple project without authentication </li> <li>Axios - for anything else</li> </ul> </section> <section> <h3>What about other tools like isomorphic fetch? </h3> <p>Feel free to use any tool that feet requirements, just ensure it's stable and supported</p> </section> </section> <section> <section> <h2>Not OK</h2> <p class="fade-up fragment left"> There is one big fail in the examples above - the component knows what data it needs (OK), how to get them (not OK) and how to put them to the store (double not OK) </p> </section> <section> <h3>We need a separations of responsibility</h3> <p>The store should be responsible about this stuff</p> </section> <section> <h3>Create a store</h3> <pre><code data-line-numbers="1-8|1-4|6-9" class="language-typescript">type ApiData = { 
    status: "pending" | "failed" | "success"; 
    entries: [] 
};

class Store {
    data: ApiData = { status: "pending", entries: [] };
    constructor() { makeAutoObservable(this); }
}
        </code></pre> </section> <section> <h3>Create a method that will fetch API</h3> <pre><code data-line-numbers="1-15|1|2|3|4-8|9-12|14" class="language-typescript">fetchApi() {
  const abort = new AbortController();
  axios.get(FREE_API_URL, { signal: abort.signal })
    .then(({ data }) => {
      runInAction(() => (
        this.data = { status: 'success', entries: data.entries })
      );
    })
    .catch(() => {
      runInAction(() => (
        this.data = { status: 'failed', entries: [] })
      );
    });
    return abort;
}
        </code></pre> </section> <section> <h3>Use from anywhere you need</h3> <pre><code class="language-tsx" data-line-numbers="1-12|1|2-5|7|9-11">const AppApp = observer(() =&gt; {
    useEffect(() =&gt; {
        const request = apiStore.fetchApi();
        return () =&gt; request.abort();
    }, []);

    const { status } = apiStore.data;

    if (status ==='pending') { return &lt;&gt;'pending'&lt;/&gt; }
    if (status === 'failed') { return &lt;&gt;'failed'&lt;/&gt; }
    return &lt;ApiList/&gt;
});
      </code></pre> </section> <section> <h3>Pros</h3> <ul> <li>Usage simplicity - just call a method</li> <li class="fade-up fragment">Data stored in a one place - caching, logging, is very easy</li> <li class="fade-up fragment">Because of using store - data is accessible anywhere</li> </ul> </section> </section> <section> <section> <h2>Typical mistakes</h2> </section> <section> <h3>Ignoring errors üíî</h3> <p class="fade-up fragment left"> If something might fail - it will fail in the most inconvenient time </p> <p class="fade-up fragment left">Start designing your component from failed point</p> </section> <section> <h3>Ignoring pending indications üíî</h3> <p class="fade-up fragment left"> Your backend is not something super stable - it might be slow because of many reasons </p> <p class="fade-up fragment left">Showing some kind of indication that response is awaited - might be a good idea </p> </section> <section> <h3>Ignoring unsubscribe üíî</h3> <p class="fade-uo fragment left"> Users will not always wait till the end of the call, they might just change the page </p> <p class="fade-uo fragment left">Always provide a way to cancel the network call</p> </section> <section> <h3>Using async in effect üíî</h3> <pre><code data-line-numbers="">// this will not work
useEffect(async () => {
    await fetch(SOME_URL)
}, []);
        </code></pre> <pre class="fade-up fragment"><code data-line-numbers=""> // but this will
useEffect(() => {
    async function myFetch() {
        await fetch(SOME_URL);
    }
    myFetch()
}, []);                    </code></pre> </section> <section> <h3>Using fetch directly in the code üíî</h3> <pre><code class="language-tsx" data-line-numbers="">const myApp = () =&gt; {
    const [data, state] = useState({});
    // calls BE each render
    fetch(SOME_URL).then(setState)
    return &lt;&gt;&lt;/&gt;
}
</code></pre> </section> <section> <h3>Using fetch without specifying dependency list in use effect üíî</h3> <pre><code class="language-tsx" data-line-numbers="">const myApp = () =&gt; {
    const [data, setState] = useState({});

    useEffect(() =&gt; {
        // calls BE each render
        fetch(SOME_URL).then(setState);
    });
    return &lt;&gt;&lt;/&gt;;
};
          </code></pre> </section> </section> <section> <h2>Takeaway</h2> <ul> <li class="fade-up fragment">Use fetch for a simple project and axios for middle/large</li> <li class="fade-up fragment">Move logic out of component</li> <li class="fade-up fragment">Don't ignore errors</li> </ul> </section> <section> <h2>Useful links</h2> <ul> <li><a target="_blank" rel="noopener noreferrer" href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API">Fetch</a></li> <li><a target="_blank" rel="noopener noreferrer" href="https://github.com/axios/axios">Axios</a></li> <li><a target="_blank" rel="noopener noreferrer" href="https://github.com/public-apis/public-apis">Public API</a></li> </ul> </section> <section> <h2>Join me</h2> <div> <svg height="32" width="32" aria-hidden="true" fill="rgba(29,161,242,1.00)" viewBox="0 0 24 24"><title>Drag13 Twitter profile</title><path d="M23.643 4.937c-.835.37-1.732.62-2.675.733a4.67 4.67 0 0 0 2.048-2.578 9.3 9.3 0 0 1-2.958 1.13 4.66 4.66 0 0 0-7.938 4.25 13.229 13.229 0 0 1-9.602-4.868c-.4.69-.63 1.49-.63 2.342A4.66 4.66 0 0 0 3.96 9.824a4.647 4.647 0 0 1-2.11-.583v.06a4.66 4.66 0 0 0 3.737 4.568 4.692 4.692 0 0 1-2.104.08 4.661 4.661 0 0 0 4.352 3.234 9.348 9.348 0 0 1-5.786 1.995 9.5 9.5 0 0 1-1.112-.065 13.175 13.175 0 0 0 7.14 2.093c8.57 0 13.255-7.098 13.255-13.254 0-.2-.005-.402-.014-.602a9.47 9.47 0 0 0 2.323-2.41z"/></svg> <a target="_blank" rel="noopener noreferrer" href="https://twitter.com/drag137">Twitter</a> </div> <div> <svg height="32" width="32" aria-hidden="true" viewBox="0 0 16 16"><title>Drag13 GitHub profile</title><path fill-rule="evenodd" fill="#fff" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg> <a target="_blank" rel="noopener noreferrer" href="https://github.com/Drag13">GitHub</a> </div> </section></div> </div> <script src="https://drag13.io/react-learning-course-short/about/index.764e4403.js" type="module"></script> <footer class="footer"> <a href="https://itera.com"> <img src="https://drag13.io/react-learning-course-short/Itera-logo-white-fuchsia.b04eab97.jpg" alt="https://itera.com"> </a> </footer> </body></html>